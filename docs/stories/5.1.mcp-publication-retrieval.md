# Story 5.1: MCP Integration for Publication Retrieval

## Status

**Draft**

## Story

**As a** user,
**I want** paper-search-mcp integrated to retrieve publications for each professor,
**so that** I can analyze recent research output.

## Acceptance Criteria

1. paper-search-mcp configured and connected (NFR6)
2. Publications retrieved for each PI from last 3 years (FR15)
3. Search queries constructed from professor name + university affiliation
4. Publication metadata collected: title, authors, journal, year, abstract
5. Results validated (correct professor, not name collision)
6. Missing publications handled gracefully (some professors may have none)
7. Progress tracking shows publication retrieval status

## Tasks / Subtasks

- [ ] **Task 1: Create Publication Pydantic Model** (AC: 4)
  - [ ] Create `src/models/publication.py`
  - [ ] Define Publication model:
    ```python
    class Publication(BaseModel):
        id: str  # DOI or generated ID
        title: str
        authors: list[str]
        journal: str
        year: int
        abstract: str = ""
        doi: Optional[str] = None
        citations: int = 0
        professor_id: str  # Links to Professor
        is_pi_publication: bool = True  # vs lab member pub
    ```

- [ ] **Task 2: Integrate paper-search-mcp** (AC: 1)
  - [ ] Use mcp_client.py from Story 1.5
  - [ ] Connect to paper-search-mcp server
  - [ ] Implement `query_paper_search(author, affiliation, years)`

- [ ] **Task 3: Query Publications for Each Professor** (AC: 2, 3)
  - [ ] For each professor from Epic 3:
    - Construct query: "author:{name} affiliation:{university}"
    - Set year_range: last 3 years
    - Call paper-search-mcp
    - Parse results into Publication models

- [ ] **Task 4: Validate Publication Authorship** (AC: 5)
  - [ ] Check if professor name in author list
  - [ ] Handle name variations (J. Smith vs Jane Smith)
  - [ ] Use LLM for fuzzy name matching if needed
  - [ ] Filter out false positives

- [ ] **Task 5: Handle Missing Publications** (AC: 6)
  - [ ] If no pubs found: Flag "no_recent_publications"
  - [ ] Don't fail processing
  - [ ] Log: "No publications for {professor_name}"

- [ ] **Task 6: Save Publications to Checkpoint** (AC: 2)
  - [ ] Save to `checkpoints/phase-4-publications-batch-{N}.jsonl`
  - [ ] Use checkpoint_manager

- [ ] **Task 7: Integrate Progress Tracking** (AC: 7)
  - [ ] Display: "Phase 4: Publication Retrieval [X/Y professors]"

## Dev Notes

### Source Tree Location
- Create: `src/agents/publication_retrieval.py`
- Create: `src/models/publication.py`
- Use: `src/utils/mcp_client.py` (from Story 1.5)

**MCP Query Pattern:**
```python
from src.utils.mcp_client import query_paper_search

pubs = await query_paper_search(
    author=professor.name,
    affiliation=university_name,
    years=3
)
```

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-10-06 | 0.1 | Initial story creation | Sarah (PO) |
