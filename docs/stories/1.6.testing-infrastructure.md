# Story 1.6: Testing Infrastructure Setup

**Epic:** Epic 1 - Foundation & Configuration Infrastructure

**Status:** Not Started

---

## Story

**As a** developer,
**I want** a complete testing infrastructure established with pytest framework, test directory structure, and example test templates,
**so that** I can write and run tests effectively for all subsequent stories starting from Epic 2.

## Acceptance Criteria

1. pytest and all testing dependencies installed (pytest, pytest-cov, pytest-asyncio, pytest-mock)
2. Test directory structure created matching source structure (`tests/unit/`, `tests/integration/`, `tests/fixtures/`)
3. pytest configuration file created (pytest.ini) with coverage settings
4. Example test templates provided for unit and integration tests
5. Test execution successfully runs with `pytest` command
6. Coverage reporting configured to generate reports
7. Testing documentation added to README with examples

## Tasks / Subtasks

- [ ] **Task 1: Verify Testing Dependencies Installed** (AC: 1)
  - [ ] Verify pytest==7.4.4 in requirements.txt (installed by Story 1.1)
  - [ ] Verify pytest-cov==4.1.0 in requirements.txt (installed by Story 1.1)
  - [ ] Verify pytest-asyncio==0.23.3 in requirements.txt (installed by Story 1.1)
  - [ ] Verify pytest-mock==3.12.0 in requirements.txt (installed by Story 1.1)
  - [ ] Confirm dependencies installed: `pip list | grep pytest`

- [ ] **Task 2: Create Test Directory Structure** (AC: 2)
  - [ ] Create `tests/` directory
  - [ ] Create `tests/unit/` directory
  - [ ] Create `tests/integration/` directory
  - [ ] Create `tests/fixtures/` directory
  - [ ] Create `tests/__init__.py` (empty file)
  - [ ] Create `tests/unit/__init__.py` (empty file)
  - [ ] Create `tests/integration/__init__.py` (empty file)

- [ ] **Task 3: Configure pytest** (AC: 3, 6)
  - [ ] Create `pytest.ini` in project root
  - [ ] Configure test discovery paths
  - [ ] Configure coverage reporting (minimum 70% target)
  - [ ] Configure async test support
  - [ ] Set up coverage output format (terminal + HTML)
  - [ ] Configure test markers (unit, integration)

- [ ] **Task 4: Create Example Test Templates** (AC: 4)
  - [ ] Create `tests/unit/test_example.py` with sample unit test
  - [ ] Create `tests/integration/test_example_integration.py` with sample integration test
  - [ ] Include AAA pattern examples (Arrange, Act, Assert)
  - [ ] Include async test example using pytest-asyncio
  - [ ] Include mock example using pytest-mock
  - [ ] Add inline comments explaining test patterns

- [ ] **Task 5: Create Test Fixtures** (AC: 2)
  - [ ] Create `tests/fixtures/sample_config.json` (example valid configuration)
  - [ ] Create `tests/fixtures/invalid_config.json` (example invalid configuration)
  - [ ] Add fixture loading utilities if needed
  - [ ] Document fixture usage in test templates

- [ ] **Task 6: Verify Test Execution** (AC: 5)
  - [ ] Run `pytest` command and verify it discovers example tests
  - [ ] Run `pytest --cov=src` and verify coverage report generates
  - [ ] Run `pytest -v` and verify verbose output works
  - [ ] Run `pytest -m unit` and verify marker filtering works
  - [ ] Verify all tests pass (example tests should pass)

- [ ] **Task 7: Document Testing Process** (AC: 7)
  - [ ] Add Testing section to README
  - [ ] Document how to run tests
  - [ ] Document how to run coverage reports
  - [ ] Provide example test commands
  - [ ] Document test organization conventions

---

## Dependencies

**Prerequisites:**
- Story 1.1 (Core Dependency Installation) - pytest and testing dependencies already in requirements.txt

**Depends On:**
- Story 1.1: Core Dependency Installation

**Blocks:**
- All Epic 2+ stories (require testing infrastructure for quality assurance)

---

## Dev Notes

### Relevant Architecture Information

**Testing Strategy (from Architecture):**

**Testing Philosophy:**
- Approach: Test-after development (not strict TDD) with focus on critical paths
- Coverage Goals:
  - Unit tests: 70% code coverage minimum
  - Integration tests: Cover all external API integrations
  - Manual end-to-end: One full university analysis per release
- Test Pyramid:
  - 60% unit tests (models, utilities, logic)
  - 30% integration tests (MCP, web scraping, checkpoint I/O)
  - 10% manual E2E tests (full pipeline on real data)

**Test Organization:**
- Unit Tests:
  - Framework: pytest 7.4.4
  - File Convention: `tests/unit/test_<module>.py`
  - Coverage Requirement: 70% minimum
- Integration Tests:
  - Scope: Test interactions between components and external services
  - Location: `tests/integration/`
  - Infrastructure: MCP servers, mock HTML files, temporary directories

**Test Infrastructure Requirements:**
- MCP Servers: Run local paper-search-mcp and mcp-linkedin servers for tests
- Web Scraping: Use mock HTML files in `tests/fixtures/`
- LinkedIn: Mock MCP server responses in tests (no real LinkedIn access)
- File I/O: Use temporary directories via pytest fixtures

**pytest Configuration Requirements:**
```ini
[pytest]
testpaths = tests
python_files = test_*.py
python_classes = Test*
python_functions = test_*
asyncio_mode = auto
markers =
    unit: Unit tests
    integration: Integration tests
addopts =
    --cov=src
    --cov-report=term-missing
    --cov-report=html
    --cov-fail-under=70
```

**Source Tree Location:**
```
tests/                           # Test suite
├── unit/                        # Unit tests
│   ├── test_models.py
│   ├── test_checkpoint_manager.py
│   ├── test_validator.py
│   └── ...
├── integration/                 # Integration tests
│   ├── test_university_discovery.py
│   ├── test_publication_retrieval.py
│   └── ...
└── fixtures/                    # Test data fixtures
    ├── sample_config.json
    ├── mock_professor_page.html
    └── ...
```

**Critical Rules (from Coding Standards):**
- Test Organization: Tests mirror source structure: `tests/unit/test_<module>.py` matches `src/<module>.py`
- Coverage: MyPy must pass without errors
- Always type hint function signatures

### Testing

**Test File Location:** `tests/unit/test_pytest_setup.py`

**Testing Standards:**
This story sets up the testing infrastructure itself, so testing is meta:

1. Create a simple test to verify pytest works: `tests/unit/test_pytest_setup.py`
2. Test should import pytest and verify basic assertions work
3. Test should verify async tests work with pytest-asyncio
4. Test should verify mocking works with pytest-mock
5. Run `pytest --cov` and verify coverage report generates

**Example Test Pattern (to include in template):**
```python
import pytest
from unittest.mock import Mock

# Unit test example (AAA pattern)
def test_example_function():
    # Arrange
    input_value = 5
    expected_output = 10

    # Act
    result = example_function(input_value)

    # Assert
    assert result == expected_output

# Async test example
@pytest.mark.asyncio
async def test_async_function():
    # Arrange
    input_value = "test"

    # Act
    result = await async_function(input_value)

    # Assert
    assert result is not None

# Mock example
def test_with_mock(mocker):
    # Arrange
    mock_dependency = mocker.patch('module.dependency')
    mock_dependency.return_value = "mocked"

    # Act
    result = function_using_dependency()

    # Assert
    assert result == "mocked"
    mock_dependency.assert_called_once()
```

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-10-06 | 0.1 | Initial story creation | Sarah (PO) |

## Dev Agent Record

### Agent Model Used

_To be populated by dev agent_

### Debug Log References

_To be populated by dev agent_

### Completion Notes List

_To be populated by dev agent_

### File List

_To be populated by dev agent_

## QA Results

_To be populated by QA agent_

---

## References

- **Architecture:** `docs/architecture.md` - Test Strategy and Standards section (lines 1599-1713)
- **Architecture:** `docs/architecture.md` - Infrastructure and Deployment section (lines 1401-1463)
- **PRD:** `docs/prd.md` - Epic 1, Story 1.6
